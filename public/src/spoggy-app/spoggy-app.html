<link rel="import" href="../../bower_components/polymer/polymer-element.html">
<link rel="import" href="../../bower_components/paper-fab/paper-fab.html">
<link rel="import" href="../../bower_components/iron-icons/iron-icons.html">
<!--<link rel="import" href="../../bower_components/paper-fab-menu/paper-fab-menu.html" />-->

<link rel="import" href="../spog-socket/spog-socket.html">
<link rel="import" href="../spog-graphe/spog-graphe.html">
<link rel="import" href="../spog-chat/spog-chat.html">

<dom-module id="spoggy-app">
  <template>
  <style>
  #fabchat {
    position: fixed;
    right: 25px;
    top: 25px;
  }
  </style>

  [[status]]
  <div hidden$="[[connected]]">[[status]]</div>

  <spog-socket socket="{{socket}}" status="{{status}}"></spog-socket>
  <spog-chat  id="chat" hidden$="[[!visibleChat]]"  socket="[[socket]]" status="[[status]]" ></spog-chat>
  <spog-graphe  hidden$="[[visibleChat]]"  socket="[[socket]]" status="[[status]]" actionstosend="{{actionstosend}}"></spog-graphe>
  <paper-fab id="fabchat" on-tap="toggleChat"  label="ðŸ˜»"></paper-fab>


  <h2>Hello [[prop1]]!</h2>
  choix de langue : [[lang]]
</template>

<script>
/**
* @customElement
* @polymer
*/
class SpoggyApp extends Polymer.Element {
  static get is() { return 'spoggy-app'; }
  static get properties() {
    return {
      prop1: {
        type: String,
        value: 'spoggy-app'
      },
      socket: {
        type: Object,
        observer: "_socketChanged"
      },
      status:{
        type: String,
        observer: '_consoleStatus'
      },
      connected:{
        type: Boolean,
      },
      tickDelay: {
        type: Number,
        value: 1000       // 15ms selon source, tempo pour envoi du snapshot par le serveur pour un jeu
      },
      visibleChat: {
        type: Boolean,
        value : true
      },
      actionstosend: {
        type: Array,
        value:[]
      },
      visibleIcon: {
        type: Boolean,
        value : false
      },
      lang: {
        type: String,
        value: "fr"
      }
    };
  }

  ready() {
    super.ready();
    var app=this;
    var tickInterval = setInterval(function() {
      if (app.connected){
        //  console.log("tick spog-app");
        if (app.actionstosend.length > 0) {
          console.log(app.actionstosend);
          app.socket.emit('newActions', app.actionstosend);
          app.actionstosend = [];
        }}
      }, this.tickDelay);
    }
    _socketChanged(s){
      var app = this;
      s.on('config', function (data) {
        console.log(data);
      });
      s.on('updateroom', function (data) {
        console.log(data);
      });
    }

    _consoleStatus(newValue, oldValue){
      console.log(oldValue +" -> "+ newValue);
      if(newValue =="connected"){
        this.connected = true;
      }else{
        this.connected = false;
      }
    }
    toggleChat(){
      this.visibleChat = !this.visibleChat;
    }


  }

  window.customElements.define(SpoggyApp.is, SpoggyApp);
  </script>
</dom-module>
